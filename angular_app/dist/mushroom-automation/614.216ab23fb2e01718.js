"use strict";(self.webpackChunkmushroom_automation=self.webpackChunkmushroom_automation||[]).push([[614],{9614:(ze,F,c)=>{function k(n,o,t,i,r,s,l){try{var u=n[s](l),d=u.value}catch(C){return void t(C)}u.done?o(d):Promise.resolve(d).then(i,r)}c.r(F),c.d(F,{administrationRoutes:()=>Ye});var e=c(540),m=c(177),h=c(3091),E=c(2692),w=c(8089),y=c(8813),a=c(9417),H=c(1626),j=c(5129),f=c(980);function V(n,o){1&n&&(e.qSk(),e.joV(),e.j41(0,"div",31)(1,"div",32),e.qSk(),e.j41(2,"svg",9),e.nrm(3,"path",33),e.k0s(),e.joV(),e.j41(4,"span",34),e.EFF(5,"Por favor, seleccione un cultivo para realizar el control."),e.k0s()()())}const S=function(n,o){return{"bg-emerald-100 border border-emerald-200":n,"bg-rose-100 border border-rose-200":o}},I=function(n,o){return{"text-emerald-700":n,"text-rose-700":o}},R=function(n,o){return{"bg-indigo-600 hover:bg-indigo-700":n,"bg-gray-400 cursor-not-allowed":o}};function D(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",48)(1,"div",49)(2,"form",50),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.setTemperature())}),e.nrm(3,"div",51),e.j41(4,"h2",52)(5,"span",53),e.EFF(6,"\u{1f321}\ufe0f"),e.k0s(),e.EFF(7," Control de Temperatura "),e.k0s(),e.j41(8,"div",54)(9,"div",55)(10,"label",56),e.EFF(11,"M\xednima (\xb0C)"),e.k0s(),e.j41(12,"div",57),e.nrm(13,"input",58),e.j41(14,"span",59),e.EFF(15),e.k0s()()(),e.j41(16,"div",55)(17,"label",60),e.EFF(18,"M\xe1xima (\xb0C)"),e.k0s(),e.j41(19,"div",57),e.nrm(20,"input",61),e.j41(21,"span",59),e.EFF(22),e.k0s()()()(),e.j41(23,"div",62)(24,"div",63)(25,"label",64),e.EFF(26,"Actual:"),e.k0s(),e.j41(27,"span",65),e.EFF(28),e.k0s()(),e.j41(29,"div",66)(30,"div",67)(31,"span",68),e.EFF(32),e.k0s()()()(),e.j41(33,"button",69),e.EFF(34," Aplicar Par\xe1metros "),e.k0s()(),e.j41(35,"form",50),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.setHumidity())}),e.nrm(36,"div",70),e.j41(37,"h2",52)(38,"span",53),e.EFF(39,"\u{1f4a7}"),e.k0s(),e.EFF(40," Control de Humedad "),e.k0s(),e.j41(41,"div",54)(42,"div",55)(43,"label",71),e.EFF(44,"M\xednima (%)"),e.k0s(),e.j41(45,"div",57),e.nrm(46,"input",72),e.j41(47,"span",59),e.EFF(48),e.k0s()()(),e.j41(49,"div",55)(50,"label",73),e.EFF(51,"M\xe1xima (%)"),e.k0s(),e.j41(52,"div",57),e.nrm(53,"input",74),e.j41(54,"span",59),e.EFF(55),e.k0s()()()(),e.j41(56,"div",62)(57,"div",63)(58,"label",64),e.EFF(59,"Actual:"),e.k0s(),e.j41(60,"span",75),e.EFF(61),e.k0s()(),e.j41(62,"div",66)(63,"div",67)(64,"span",68),e.EFF(65),e.k0s()()()(),e.j41(66,"button",69),e.EFF(67," Aplicar Par\xe1metros "),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(2),e.Y8G("formGroup",t.temperatureForm),e.R7$(13),e.SpI("Actual: ",t.minTemperatureSet,"\xb0C"),e.R7$(7),e.SpI("Actual: ",t.maxTemperatureSet,"\xb0C"),e.R7$(6),e.SpI("",(null==t.latestTemperature?null:t.latestTemperature.toFixed(3))||"--","\xb0C"),e.R7$(2),e.Y8G("ngClass",e.l_i(18,S,t.isTemperatureIdeal(),!t.isTemperatureIdeal())),e.R7$(1),e.Y8G("ngClass",e.l_i(21,I,t.isTemperatureIdeal(),!t.isTemperatureIdeal())),e.R7$(1),e.SpI(" ",t.getTemperatureStatus()," "),e.R7$(1),e.Y8G("disabled",!t.clientService.getCurrentClientId())("ngClass",e.l_i(24,R,t.clientService.getCurrentClientId(),!t.clientService.getCurrentClientId())),e.R7$(2),e.Y8G("formGroup",t.humidityForm),e.R7$(13),e.SpI("Actual: ",t.minHumiditySet,"%"),e.R7$(7),e.SpI("Actual: ",t.maxHumiditySet,"%"),e.R7$(6),e.SpI("",(null==t.latestHumidity?null:t.latestHumidity.toFixed(3))||"--","%"),e.R7$(2),e.Y8G("ngClass",e.l_i(27,S,t.isHumidityIdeal(),!t.isHumidityIdeal())),e.R7$(1),e.Y8G("ngClass",e.l_i(30,I,t.isHumidityIdeal(),!t.isHumidityIdeal())),e.R7$(1),e.SpI(" ",t.getHumidityStatus()," "),e.R7$(1),e.Y8G("disabled",!t.clientService.getCurrentClientId())("ngClass",e.l_i(33,R,t.clientService.getCurrentClientId(),!t.clientService.getCurrentClientId()))}}function N(n,o){if(1&n&&(e.qSk(),e.j41(0,"svg",92),e.nrm(1,"path",93),e.k0s()),2&n){const t=e.XpG(3);e.AVh("rotate-180",t.lucesEncendidas())}}function Y(n,o){1&n&&(e.qSk(),e.j41(0,"svg",94),e.nrm(1,"circle",95)(2,"path",96),e.k0s())}function z(n,o){if(1&n&&(e.qSk(),e.j41(0,"svg",92),e.nrm(1,"path",93),e.k0s()),2&n){const t=e.XpG(3);e.AVh("rotate-180",t.ventiladoresEncendidos())}}function X(n,o){1&n&&(e.qSk(),e.j41(0,"svg",94),e.nrm(1,"circle",95)(2,"path",96),e.k0s())}function B(n,o){if(1&n&&(e.qSk(),e.j41(0,"svg",92),e.nrm(1,"path",93),e.k0s()),2&n){const t=e.XpG(3);e.AVh("rotate-180",t.humidificadorEncendido())}}function L(n,o){1&n&&(e.qSk(),e.j41(0,"svg",94),e.nrm(1,"circle",95)(2,"path",96),e.k0s())}function q(n,o){if(1&n&&(e.qSk(),e.j41(0,"svg",92),e.nrm(1,"path",93),e.k0s()),2&n){const t=e.XpG(3);e.AVh("rotate-180",t.motorEncendido())}}function J(n,o){1&n&&(e.qSk(),e.j41(0,"svg",94),e.nrm(1,"circle",95)(2,"path",96),e.k0s())}const v=function(n,o){return{"text-emerald-700":n,"text-gray-500":o}},_=function(n,o){return{"bg-emerald-500 animate-pulse":n,"bg-gray-300":o}},x=function(n,o){return{"bg-emerald-600 hover:bg-emerald-700":n,"bg-indigo-600 hover:bg-indigo-700":o}};function P(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",76)(1,"div",77)(2,"div",78)(3,"h2",79)(4,"span",53),e.EFF(5,"\u{1f4a1}"),e.k0s(),e.EFF(6," Luces "),e.k0s()(),e.j41(7,"div",80)(8,"div",81)(9,"div",82),e.nrm(10,"span",83),e.j41(11,"span",84),e.EFF(12),e.k0s()()(),e.j41(13,"button",85),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleLuces())}),e.j41(14,"div",86),e.DNE(15,N,2,2,"svg",87),e.DNE(16,Y,3,0,"svg",88),e.j41(17,"span"),e.EFF(18),e.k0s()(),e.nrm(19,"div",89),e.k0s()()(),e.j41(20,"div",77)(21,"div",90)(22,"h2",79)(23,"span",53),e.EFF(24,"\u{1f504}"),e.k0s(),e.EFF(25," Ventiladores "),e.k0s()(),e.j41(26,"div",80)(27,"div",81)(28,"div",82),e.nrm(29,"span",83),e.j41(30,"span",84),e.EFF(31),e.k0s()()(),e.j41(32,"button",85),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleVentiladores())}),e.j41(33,"div",86),e.DNE(34,z,2,2,"svg",87),e.DNE(35,X,3,0,"svg",88),e.j41(36,"span"),e.EFF(37),e.k0s()(),e.nrm(38,"div",89),e.k0s()()(),e.j41(39,"div",77)(40,"div",90)(41,"h2",79)(42,"span",53),e.EFF(43,"\u2601\ufe0f"),e.k0s(),e.EFF(44," Humidificador "),e.k0s()(),e.j41(45,"div",80)(46,"div",81)(47,"div",82),e.nrm(48,"span",83),e.j41(49,"span",84),e.EFF(50),e.k0s()()(),e.j41(51,"button",85),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleHumidificador())}),e.j41(52,"div",86),e.DNE(53,B,2,2,"svg",87),e.DNE(54,L,3,0,"svg",88),e.j41(55,"span"),e.EFF(56),e.k0s()(),e.nrm(57,"div",89),e.k0s()()(),e.j41(58,"div",77)(59,"div",91)(60,"h2",79)(61,"span",53),e.EFF(62,"\u{1f527}"),e.k0s(),e.EFF(63," Motor "),e.k0s()(),e.j41(64,"div",80)(65,"div",81)(66,"div",82),e.nrm(67,"span",83),e.j41(68,"span",84),e.EFF(69),e.k0s()()(),e.j41(70,"button",85),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleMotor())}),e.j41(71,"div",86),e.DNE(72,q,2,2,"svg",87),e.DNE(73,J,3,0,"svg",88),e.j41(74,"span"),e.EFF(75),e.k0s()(),e.nrm(76,"div",89),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(8),e.Y8G("ngClass",e.l_i(40,v,t.lucesEncendidas(),!t.lucesEncendidas())),e.R7$(2),e.Y8G("ngClass",e.l_i(43,_,t.lucesEncendidas(),!t.lucesEncendidas())),e.R7$(2),e.JRh(t.lucesEncendidas()?"Encendidas":"Apagadas"),e.R7$(1),e.Y8G("ngClass",e.l_i(46,x,t.lucesEncendidas(),!t.lucesEncendidas()))("disabled",t.procesandoLuces),e.R7$(2),e.Y8G("ngIf",!t.procesandoLuces),e.R7$(1),e.Y8G("ngIf",t.procesandoLuces),e.R7$(2),e.JRh(t.procesandoLuces?"Procesando...":t.lucesEncendidas()?"Apagar":"Encender"),e.R7$(1),e.xc7("width",t.procesandoLuces?"100%":"0"),e.R7$(8),e.Y8G("ngClass",e.l_i(49,v,t.ventiladoresEncendidos(),!t.ventiladoresEncendidos())),e.R7$(2),e.Y8G("ngClass",e.l_i(52,_,t.ventiladoresEncendidos(),!t.ventiladoresEncendidos())),e.R7$(2),e.JRh(t.ventiladoresEncendidos()?"Encendidos":"Apagados"),e.R7$(1),e.Y8G("ngClass",e.l_i(55,x,t.ventiladoresEncendidos(),!t.ventiladoresEncendidos()))("disabled",t.procesandoVentiladores),e.R7$(2),e.Y8G("ngIf",!t.procesandoVentiladores),e.R7$(1),e.Y8G("ngIf",t.procesandoVentiladores),e.R7$(2),e.JRh(t.procesandoVentiladores?"Procesando...":t.ventiladoresEncendidos()?"Apagar":"Encender"),e.R7$(1),e.xc7("width",t.procesandoVentiladores?"100%":"0"),e.R7$(8),e.Y8G("ngClass",e.l_i(58,v,t.humidificadorEncendido(),!t.humidificadorEncendido())),e.R7$(2),e.Y8G("ngClass",e.l_i(61,_,t.humidificadorEncendido(),!t.humidificadorEncendido())),e.R7$(2),e.JRh(t.humidificadorEncendido()?"Encendido":"Apagado"),e.R7$(1),e.Y8G("ngClass",e.l_i(64,x,t.humidificadorEncendido(),!t.humidificadorEncendido()))("disabled",t.procesandoHumidificador),e.R7$(2),e.Y8G("ngIf",!t.procesandoHumidificador),e.R7$(1),e.Y8G("ngIf",t.procesandoHumidificador),e.R7$(2),e.JRh(t.procesandoHumidificador?"Procesando...":t.humidificadorEncendido()?"Apagar":"Encender"),e.R7$(1),e.xc7("width",t.procesandoHumidificador?"100%":"0"),e.R7$(8),e.Y8G("ngClass",e.l_i(67,v,t.motorEncendido(),!t.motorEncendido())),e.R7$(2),e.Y8G("ngClass",e.l_i(70,_,t.motorEncendido(),!t.motorEncendido())),e.R7$(2),e.JRh(t.motorEncendido()?"Encendido":"Apagado"),e.R7$(1),e.Y8G("ngClass",e.l_i(73,x,t.motorEncendido(),!t.motorEncendido()))("disabled",t.procesandoMotor),e.R7$(2),e.Y8G("ngIf",!t.procesandoMotor),e.R7$(1),e.Y8G("ngIf",t.procesandoMotor),e.R7$(2),e.JRh(t.procesandoMotor?"Procesando...":t.motorEncendido()?"Apagar":"Encender"),e.R7$(1),e.xc7("width",t.procesandoMotor?"100%":"0")}}function O(n,o){if(1&n&&(e.qSk(),e.joV(),e.j41(0,"div",35),e.DNE(1,D,68,36,"div",36),e.DNE(2,P,77,76,"div",37),e.j41(3,"div",38),e.nrm(4,"div",39),e.j41(5,"div",40)(6,"h3",41),e.qSk(),e.j41(7,"svg",42),e.nrm(8,"path",43),e.k0s(),e.EFF(9," Informaci\xf3n "),e.k0s(),e.joV(),e.j41(10,"div",44)(11,"div",45)(12,"p",46),e.EFF(13,"Modo Autom\xe1tico"),e.k0s(),e.j41(14,"p",47),e.EFF(15,"Los actuadores se controlan seg\xfan los par\xe1metros configurados de temperatura y humedad establecidos."),e.k0s()(),e.j41(16,"div",45)(17,"p",46),e.EFF(18,"Modo Manual"),e.k0s(),e.j41(19,"p",47),e.EFF(20,"Controla directamente los actuadores seg\xfan tus necesidades, sin considerar los par\xe1metros autom\xe1ticos."),e.k0s()()()()()()),2&n){const t=e.XpG();e.R7$(1),e.Y8G("ngIf","automatico"===t.mode),e.R7$(1),e.Y8G("ngIf","manual"===t.mode)}}function W(n,o){1&n&&(e.qSk(),e.joV(),e.j41(0,"div",97)(1,"div",98),e.qSk(),e.j41(2,"svg",99),e.nrm(3,"path",100),e.k0s(),e.joV(),e.j41(4,"h2",101),e.EFF(5,"No hay cultivo seleccionado"),e.k0s(),e.j41(6,"p",102),e.EFF(7,'Por favor, seleccione un cultivo en la secci\xf3n de "Gesti\xf3n de Cultivos" para poder administrar sus par\xe1metros y controlar sus actuadores.'),e.k0s(),e.j41(8,"a",103),e.qSk(),e.j41(9,"svg",9),e.nrm(10,"path",104),e.k0s(),e.EFF(11," Ir a Gesti\xf3n de Cultivos "),e.k0s()()())}const T=function(n,o){return{"bg-indigo-600 text-white shadow-md":n,"bg-transparent text-gray-700 hover:bg-indigo-200":o}},U=function(){return["/home"]},Q=function(){return["/administration/client-management"]};class Z{showError(o){console.error(o)}}let K=(()=>{class n{constructor(){this.actuatorService=(0,e.WQX)(E.X),this.dashboardService=(0,e.WQX)(w.I),this.clientService=(0,e.WQX)(y.X),this.fb=(0,e.WQX)(a.ok),this.http=(0,e.WQX)(H.Qq),this.authService=(0,e.WQX)(j.u),this.toastService=new Z,this.clients=[],this.lucesEncendidas=(0,e.vPA)(!1),this.ventiladoresEncendidos=(0,e.vPA)(!1),this.humidificadorEncendido=(0,e.vPA)(!1),this.motorEncendido=(0,e.vPA)(!1),this.minTemperatureSet=20,this.maxTemperatureSet=30,this.minHumiditySet=40,this.maxHumiditySet=80,this.mode="automatico",this.temperatureForm=new a.gE({minTemperature:new a.MJ(20,[a.k0.required,a.k0.min(10),a.k0.max(30)]),maxTemperature:new a.MJ(30,[a.k0.required,a.k0.min(10),a.k0.max(35)])}),this.humidityForm=new a.gE({minHumidity:new a.MJ(40,[a.k0.required,a.k0.min(30),a.k0.max(90)]),maxHumidity:new a.MJ(80,[a.k0.required,a.k0.min(40),a.k0.max(100)])}),this.procesandoLuces=!1,this.procesandoVentiladores=!1,this.procesandoHumidificador=!1,this.procesandoMotor=!1,(0,e.QZP)(()=>{this.clientService.currentClientId$(),this.intervalId&&(this.resetData(),this.getAppState(),this.fetchSensorData(),this.fetchActuatorStates(),this.fetchIdealParams(),this.loadClients())})}loadClients(){this.authService.getClients().subscribe({next:t=>{this.clients=t},error:t=>{console.error("Error loading clients:",t)}})}getCurrentClientName(){const t=this.clientService.getCurrentClientId(),i=this.clients.find(r=>r.client_id===t);return i?i.name:""}ngOnInit(){this.getAppState(),this.fetchSensorData(),this.fetchActuatorStates(),this.fetchIdealParams(),this.loadClients(),this.validateForms(),this.intervalId=setInterval(()=>{this.fetchSensorData(),this.fetchActuatorStates()},5e3)}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}resetData(){this.latestTemperature=void 0,this.latestHumidity=void 0,this.lucesEncendidas.set(!1),this.ventiladoresEncendidos.set(!1),this.humidificadorEncendido.set(!1),this.motorEncendido.set(!1),this.temperatureForm.setValue({minTemperature:20,maxTemperature:30}),this.humidityForm.setValue({minHumidity:40,maxHumidity:80}),this.validateForms()}validateForms(){this.temperatureForm.updateValueAndValidity(),this.humidityForm.updateValueAndValidity(),Object.keys(this.temperatureForm.controls).forEach(t=>{const i=this.temperatureForm.get(t);i?.markAsTouched(),i?.updateValueAndValidity()}),Object.keys(this.humidityForm.controls).forEach(t=>{const i=this.humidityForm.get(t);i?.markAsTouched(),i?.updateValueAndValidity()})}setMode(t){this.mode=t;const i=this.clientService.getCurrentClientId();i&&this.dashboardService.updateAppState(i,t).subscribe({next:()=>{setTimeout(()=>{this.fetchSensorData(),this.fetchActuatorStates()},500)},error:r=>{console.error("Error al actualizar el estado de la aplicaci\xf3n:",r),this.mode="automatico"===t?"manual":"automatico"}})}getAppState(){var t=this;return function A(n){return function(){var o=this,t=arguments;return new Promise(function(i,r){var s=n.apply(o,t);function l(d){k(s,i,r,l,u,"next",d)}function u(d){k(s,i,r,l,u,"throw",d)}l(void 0)})}}(function*(){try{const i=t.clientService.getCurrentClientId();if(!i)return;const r=yield t.dashboardService.getAppState(i).toPromise();r&&(t.mode=r.mode)}catch(i){console.error("Error al obtener el estado de la aplicaci\xf3n:",i)}})()}fetchSensorData(){const t=this.clientService.getCurrentClientId();t&&("automatico"===this.mode?this.dashboardService.getSht3xUrlData(t,1,10,!1):this.dashboardService.getSht3xUrlDataManual(t,1,10,!1)).subscribe({next:r=>{r&&r.length>0&&(r.sort((s,l)=>new Date(l.timestamp).getTime()-new Date(s.timestamp).getTime()),this.latestHumidity=r[0].humidity,this.latestTemperature=r[0].temperature)},error:r=>{console.error("Error al obtener datos de sensores:",r)}})}fetchActuatorStates(){const t=this.clientService.getCurrentClientId();t&&this.dashboardService.getActuators(t,1,10,!1).subscribe({next:i=>{const r=i.find(d=>"Iluminacion"===d.name),s=i.find(d=>"Ventilacion"===d.name),l=i.find(d=>"Humidificador"===d.name),u=i.find(d=>"Motor"===d.name);r&&this.lucesEncendidas.set("true"===r.state),s&&this.ventiladoresEncendidos.set("true"===s.state),l&&this.humidificadorEncendido.set("true"===l.state),u&&this.motorEncendido.set("true"===u.state)},error:i=>{console.error("Error al obtener estados de actuadores:",i)}})}fetchIdealParams(){const t=this.clientService.getCurrentClientId();t&&(this.actuatorService.getIdealParams(t,"temperatura").subscribe({next:i=>{i&&void 0!==i.min_value&&void 0!==i.max_value&&(this.minTemperatureSet=i.min_value,this.maxTemperatureSet=i.max_value,this.temperatureForm.patchValue({minTemperature:i.min_value,maxTemperature:i.max_value},{emitEvent:!0}),this.temperatureForm.updateValueAndValidity(),this.temperatureForm.get("minTemperature")?.markAsTouched(),this.temperatureForm.get("maxTemperature")?.markAsTouched())},error:i=>{console.error("Error al obtener par\xe1metros ideales de temperatura:",i)}}),this.actuatorService.getIdealParams(t,"humedad").subscribe({next:i=>{i&&void 0!==i.min_value&&void 0!==i.max_value&&(this.minHumiditySet=i.min_value,this.maxHumiditySet=i.max_value,this.humidityForm.patchValue({minHumidity:i.min_value,maxHumidity:i.max_value},{emitEvent:!0}),this.humidityForm.updateValueAndValidity(),this.humidityForm.get("minHumidity")?.markAsTouched(),this.humidityForm.get("maxHumidity")?.markAsTouched())},error:i=>{console.error("Error al obtener par\xe1metros ideales de humedad:",i)}}))}toggleLuces(){if(this.procesandoLuces)return;this.procesandoLuces=!0;const t=!this.lucesEncendidas();this.lucesEncendidas.set(t);const i=this.clientService.getCurrentClientId();i?this.actuatorService.lightControl(i,t?"true":"false").pipe((0,f.j)(()=>{setTimeout(()=>this.procesandoLuces=!1,300)})).subscribe({next:()=>{},error:s=>{console.error("Error al cambiar estado de luces:",s),this.lucesEncendidas.set(!t),this.toastService.showError("Error al cambiar el estado de las luces")}}):this.procesandoLuces=!1}toggleVentiladores(){if(this.procesandoVentiladores)return;this.procesandoVentiladores=!0;const t=!this.ventiladoresEncendidos();this.ventiladoresEncendidos.set(t);const i=this.clientService.getCurrentClientId();i?this.actuatorService.fanControl(i,t?"true":"false").pipe((0,f.j)(()=>{setTimeout(()=>this.procesandoVentiladores=!1,300)})).subscribe({next:()=>{},error:s=>{console.error("Error al cambiar estado de ventiladores:",s),this.ventiladoresEncendidos.set(!t),this.toastService.showError("Error al cambiar el estado de los ventiladores")}}):this.procesandoVentiladores=!1}toggleHumidificador(){if(this.procesandoHumidificador)return;this.procesandoHumidificador=!0;const t=!this.humidificadorEncendido();this.humidificadorEncendido.set(t);const i=this.clientService.getCurrentClientId();i?this.actuatorService.humidifierControl(i,t?"true":"false").pipe((0,f.j)(()=>{setTimeout(()=>this.procesandoHumidificador=!1,300)})).subscribe({next:()=>{},error:s=>{console.error("Error al cambiar estado del humidificador:",s),this.humidificadorEncendido.set(!t),this.toastService.showError("Error al cambiar el estado del humidificador")}}):this.procesandoHumidificador=!1}toggleMotor(){if(this.procesandoMotor)return;this.procesandoMotor=!0;const t=!this.motorEncendido();this.motorEncendido.set(t);const i=this.clientService.getCurrentClientId();i?this.actuatorService.motorControl(i,t?"true":"false").pipe((0,f.j)(()=>{setTimeout(()=>this.procesandoMotor=!1,300)})).subscribe({next:()=>{},error:s=>{console.error("Error al cambiar estado del motor:",s),this.motorEncendido.set(!t),this.toastService.showError("Error al cambiar el estado del motor")}}):this.procesandoMotor=!1}setTemperature(){const t=this.clientService.getCurrentClientId();if(t)if(this.temperatureForm.valid){const{minTemperature:i,maxTemperature:r}=this.temperatureForm.value;if(null===i||null===r||void 0===i||void 0===r)return void console.error("Valores de temperatura inv\xe1lidos");if(i>=r)return void console.error("La temperatura m\xednima debe ser menor que la m\xe1xima");this.actuatorService.putIdealParams(t,"temperatura",{min_value:i,max_value:r}).subscribe({next:()=>{this.minTemperatureSet=i,this.maxTemperatureSet=r},error:l=>{console.error("Error al actualizar par\xe1metros de temperatura:",l)}})}else console.error("Formulario de temperatura inv\xe1lido:",this.temperatureForm.errors)}setHumidity(){const t=this.clientService.getCurrentClientId();if(t)if(this.humidityForm.updateValueAndValidity(),this.humidityForm.valid){const{minHumidity:i,maxHumidity:r}=this.humidityForm.value;if(null===i||null===r||void 0===i||void 0===r)return void console.error("Valores de humedad inv\xe1lidos");if(i>=r)return void console.error("La humedad m\xednima debe ser menor que la m\xe1xima");this.actuatorService.putIdealParams(t,"humedad",{min_value:i,max_value:r}).subscribe({next:()=>{this.minHumiditySet=i,this.maxHumiditySet=r},error:l=>{console.error("Error al actualizar par\xe1metros de humedad:",l)}})}else console.error("Formulario de humedad inv\xe1lido:",this.humidityForm.errors),Object.keys(this.humidityForm.controls).forEach(i=>{const r=this.humidityForm.get(i);console.error(`Control ${i} errors:`,r?.errors)})}getTemperatureStatus(){return this.latestTemperature&&void 0!==this.minTemperatureSet&&void 0!==this.maxTemperatureSet?this.latestTemperature<this.minTemperatureSet?"Temperatura baja":this.latestTemperature>this.maxTemperatureSet?"Temperatura alta":"Temperatura ideal":"Sin datos"}getHumidityStatus(){return this.latestHumidity&&void 0!==this.minHumiditySet&&void 0!==this.maxHumiditySet?this.latestHumidity<this.minHumiditySet?"Humedad baja":this.latestHumidity>this.maxHumiditySet?"Humedad alta":"Humedad ideal":"Sin datos"}isTemperatureIdeal(){return!(!this.latestTemperature||void 0===this.minTemperatureSet||void 0===this.maxTemperatureSet)&&this.latestTemperature>=this.minTemperatureSet&&this.latestTemperature<=this.maxTemperatureSet}isHumidityIdeal(){return!(!this.latestHumidity||void 0===this.minHumiditySet||void 0===this.maxHumiditySet)&&this.latestHumidity>=this.minHumiditySet&&this.latestHumidity<=this.maxHumiditySet}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-actuator-control"]],standalone:!0,features:[e.aNF],decls:44,vars:18,consts:[[1,"mb-6","bg-gradient-to-br","from-indigo-50","to-white","p-6","rounded-xl","shadow-md","border","border-indigo-100"],[1,"flex","flex-col","lg:flex-row","items-center","justify-between","gap-6"],[1,"flex","flex-col","items-center","gap-4","lg:items-start","order-2","lg:order-1"],[1,"text-xl","font-bold","text-gray-800","flex","items-center"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-6","w-6","mr-2","text-indigo-600"],["fill-rule","evenodd","d","M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z","clip-rule","evenodd"],[1,"text-indigo-600","ml-2"],[1,"bg-indigo-100","p-1","rounded-xl","shadow-sm","border","border-indigo-200"],[1,"px-5","py-2.5","rounded-xl","font-medium","transition-all","duration-200","flex","items-center",3,"ngClass","click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","mr-2"],["fill-rule","evenodd","d","M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z","clip-rule","evenodd"],["fill-rule","evenodd","d","M6.672 1.911a1 1 0 10-1.932.518l.259.966a1 1 0 001.932-.518l-.26-.966zM2.429 4.74a1 1 0 10-.517 1.932l.966.259a1 1 0 00.517-1.932l-.966-.26zm8.814-.569a1 1 0 00-1.415-1.414l-.707.707a1 1 0 101.415 1.415l.707-.708zm-7.071 7.072l.707-.707A1 1 0 003.465 9.12l-.708.707a1 1 0 001.415 1.415zm3.2-5.171a1 1 0 00-1.3 1.3l4 10a1 1 0 001.823.075l1.38-2.759 3.018 3.02a1 1 0 001.414-1.415l-3.019-3.02 2.76-1.379a1 1 0 00-.076-1.822l-10-4z","clip-rule","evenodd"],[1,"flex-1","flex","flex-col","sm:flex-row","sm:items-center","gap-4","order-1","lg:order-2"],[1,"flex-1","p-4","bg-white","rounded-lg","shadow-sm","border","border-gray-100"],[1,"flex","items-center","gap-2","mb-1"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","text-emerald-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-sm","font-medium","text-gray-500"],[1,"flex","items-center"],[1,"w-3","h-3","rounded-full","bg-emerald-500","mr-2"],[1,"text-lg","font-medium","text-gray-800"],[1,"text-sm","text-gray-500","mt-1"],[1,"flex","flex-wrap","gap-2","sm:justify-end"],[1,"inline-flex","items-center","justify-center","px-4","py-2","bg-indigo-500","hover:bg-indigo-600","text-white","rounded-lg","shadow-sm","transition-all","duration-300",3,"routerLink"],["d","M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"],[1,"inline-flex","items-center","justify-center","px-4","py-2","bg-emerald-500","hover:bg-emerald-600","text-white","rounded-lg","shadow-sm","transition-all","duration-300",3,"routerLink"],["d","M8 5a1 1 0 100 2h5.586l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L13.586 5H8z"],["d","M2 12a2 2 0 012-2h7a2 2 0 012 2v3a2 2 0 01-2 2H4a2 2 0 01-2-2v-3z"],["class","bg-amber-50 p-3 rounded-lg border border-amber-100 mt-4",4,"ngIf"],["class","control-panel p-8 bg-gradient-to-br from-indigo-50 to-white rounded-2xl shadow-xl border border-indigo-100",4,"ngIf"],["class","p-8 bg-gradient-to-br from-indigo-50 to-white rounded-2xl shadow-md border border-indigo-100",4,"ngIf"],[1,"bg-amber-50","p-3","rounded-lg","border","border-amber-100","mt-4"],[1,"flex","items-center","text-amber-700"],["fill-rule","evenodd","d","M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule","evenodd"],[1,"text-sm","font-medium"],[1,"control-panel","p-8","bg-gradient-to-br","from-indigo-50","to-white","rounded-2xl","shadow-xl","border","border-indigo-100"],["class","space-y-8",4,"ngIf"],["class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",4,"ngIf"],[1,"bg-gradient-to-r","from-indigo-50","to-white","border","border-indigo-100","rounded-xl","shadow-lg","mt-10","overflow-hidden","relative"],[1,"absolute","top-0","left-0","w-1","h-full","bg-indigo-500"],[1,"p-5"],[1,"text-lg","font-semibold","text-gray-800","mb-2","flex","items-center","gap-2"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-indigo-500"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2h2a1 1 0 100-2H9z","clip-rule","evenodd"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"bg-white","p-4","rounded-lg","shadow-sm","border","border-indigo-50"],[1,"font-medium","text-indigo-600","mb-2"],[1,"text-gray-600","text-sm"],[1,"space-y-8"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-8"],[1,"bg-gradient-to-br","from-white","to-gray-50","p-6","rounded-xl","shadow-lg","text-center","border","border-gray-100","overflow-hidden","relative",3,"formGroup","ngSubmit"],[1,"absolute","top-0","left-0","w-2","h-full","bg-rose-500"],[1,"text-lg","font-semibold","text-gray-800","mb-6","flex","items-center","justify-center","gap-2"],[1,"text-2xl"],[1,"flex","flex-col","items-center","justify-center","space-y-5","mb-6"],[1,"flex","items-center","space-x-4","w-full"],["for","minTemperatureInput",1,"block","text-sm","font-medium","text-gray-700","w-1/3","text-right"],[1,"w-2/3","flex","items-center","gap-2"],["type","number","id","minTemperatureInput","formControlName","minTemperature","min","10","max","30","placeholder","Actualizar m\xednima",1,"block","w-full","px-4","py-2","border","border-gray-200","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-rose-500","focus:border-rose-300","sm:text-sm"],[1,"text-sm","text-gray-500","whitespace-nowrap"],["for","maxTemperatureInput",1,"block","text-sm","font-medium","text-gray-700","w-1/3","text-right"],["type","number","id","maxTemperatureInput","formControlName","maxTemperature","min","10","max","35","placeholder","Actualizar m\xe1xima",1,"block","w-full","px-4","py-2","border","border-gray-200","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-rose-500","focus:border-rose-300","sm:text-sm"],[1,"flex","flex-col","items-center","justify-center","gap-3","bg-gray-50","p-4","rounded-lg","border","border-gray-100"],[1,"flex","items-center","gap-3"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"text-2xl","font-bold","text-rose-600"],[1,"mt-2","flex","items-center","justify-center","w-full"],[1,"py-2","px-4","rounded-full","shadow-md","flex","items-center","gap-2","animate-pulse",3,"ngClass"],[1,"font-bold",3,"ngClass"],["type","submit",1,"mt-6","px-8","py-3","rounded-xl","text-white","font-semibold","shadow-md","transition-all","duration-300",3,"disabled","ngClass"],[1,"absolute","top-0","left-0","w-2","h-full","bg-sky-500"],["for","minHumidityInput",1,"block","text-sm","font-medium","text-gray-700","w-1/3","text-right"],["type","number","id","minHumidityInput","formControlName","minHumidity","min","30","max","90","placeholder","Actualizar m\xednima",1,"block","w-full","px-4","py-2","border","border-gray-200","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-sky-500","focus:border-sky-300","sm:text-sm"],["for","maxHumidityInput",1,"block","text-sm","font-medium","text-gray-700","w-1/3","text-right"],["type","number","id","maxHumidityInput","formControlName","maxHumidity","min","40","max","100","placeholder","Actualizar m\xe1xima",1,"block","w-full","px-4","py-2","border","border-gray-200","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-sky-500","focus:border-sky-300","sm:text-sm"],[1,"text-2xl","font-bold","text-sky-600"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-6"],[1,"bg-white","p-0","rounded-xl","shadow-lg","flex","flex-col","items-center","justify-center","border","border-gray-100","overflow-hidden","relative","hover:shadow-xl","transition-all","duration-300","transform","hover:-translate-y-1"],[1,"w-full","bg-amber-500","py-3","text-center"],[1,"text-lg","font-semibold","text-white","flex","items-center","justify-center","gap-2"],[1,"p-6","flex","flex-col","items-center","justify-center","w-full","space-y-4"],[1,"mt-1","px-4","py-2.5","rounded-md","text-sm","font-medium","w-full","text-center","bg-gray-50","border","border-gray-100","shadow-inner","transition-all","duration-200",3,"ngClass"],[1,"flex","items-center","justify-center","gap-2"],[1,"h-2.5","w-2.5","rounded-full","transition-colors","duration-200",3,"ngClass"],[1,"font-medium"],[1,"w-full","px-6","py-3","rounded-xl","text-white","font-semibold","shadow-md","transition-all","duration-300","relative","overflow-hidden",3,"ngClass","disabled","click"],[1,"flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","class","h-5 w-5 mr-2 transition-transform duration-300","viewBox","0 0 20 20","fill","currentColor",3,"rotate-180",4,"ngIf"],["class","animate-spin h-5 w-5 mr-2","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",4,"ngIf"],[1,"absolute","bottom-0","left-0","h-1","bg-white/20","transition-all","duration-500","ease-out"],[1,"w-full","bg-sky-500","py-3","text-center"],[1,"w-full","bg-slate-500","py-3","text-center"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","mr-2","transition-transform","duration-300"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z","clip-rule","evenodd"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","mr-2"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"p-8","bg-gradient-to-br","from-indigo-50","to-white","rounded-2xl","shadow-md","border","border-indigo-100"],[1,"text-center","py-16"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-16","w-16","mx-auto","text-indigo-400","mb-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-2xl","font-bold","text-gray-800","mb-4"],[1,"text-gray-600","mb-8","max-w-md","mx-auto"],["routerLink","/administration/client-management",1,"inline-flex","items-center","justify-center","px-6","py-3","bg-indigo-600","hover:bg-indigo-700","text-white","rounded-lg","shadow-md","transition-all","duration-300"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z","clip-rule","evenodd"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.qSk(),e.j41(4,"svg",4),e.nrm(5,"path",5),e.k0s(),e.EFF(6," Control del Cultivo: "),e.joV(),e.j41(7,"span",6),e.EFF(8),e.k0s()(),e.j41(9,"div",7)(10,"button",8),e.bIt("click",function(){return r.setMode("automatico")}),e.qSk(),e.j41(11,"svg",9),e.nrm(12,"path",10),e.k0s(),e.EFF(13," Autom\xe1tico "),e.k0s(),e.joV(),e.j41(14,"button",8),e.bIt("click",function(){return r.setMode("manual")}),e.qSk(),e.j41(15,"svg",9),e.nrm(16,"path",11),e.k0s(),e.EFF(17," Manual "),e.k0s()()(),e.joV(),e.j41(18,"div",12)(19,"div",13)(20,"div",14),e.qSk(),e.j41(21,"svg",15),e.nrm(22,"path",16),e.k0s(),e.joV(),e.j41(23,"span",17),e.EFF(24,"Cultivo Activo:"),e.k0s()(),e.j41(25,"div",18),e.nrm(26,"div",19),e.j41(27,"span",20),e.EFF(28),e.k0s()(),e.j41(29,"div",21),e.EFF(30),e.k0s()(),e.j41(31,"div",22)(32,"a",23),e.qSk(),e.j41(33,"svg",9),e.nrm(34,"path",24),e.k0s(),e.EFF(35," Dashboard "),e.k0s(),e.joV(),e.j41(36,"a",25),e.qSk(),e.j41(37,"svg",9),e.nrm(38,"path",26)(39,"path",27),e.k0s(),e.EFF(40," Gestionar Cultivos "),e.k0s()()()(),e.DNE(41,V,6,0,"div",28),e.k0s(),e.DNE(42,O,21,2,"div",29),e.DNE(43,W,12,0,"div",30)),2&i&&(e.R7$(8),e.JRh(r.getCurrentClientName()),e.R7$(2),e.Y8G("ngClass",e.l_i(10,T,"automatico"===r.mode,"automatico"!==r.mode)),e.R7$(4),e.Y8G("ngClass",e.l_i(13,T,"manual"===r.mode,"manual"!==r.mode)),e.R7$(14),e.JRh(r.getCurrentClientName()||"No hay cultivo seleccionado"),e.R7$(2),e.SpI("ID: ",r.clientService.getCurrentClientId(),""),e.R7$(2),e.Y8G("routerLink",e.lJ4(16,U)),e.R7$(4),e.Y8G("routerLink",e.lJ4(17,Q)),e.R7$(5),e.Y8G("ngIf",!r.clientService.getCurrentClientId()),e.R7$(1),e.Y8G("ngIf",r.clientService.getCurrentClientId()),e.R7$(1),e.Y8G("ngIf",!r.clientService.getCurrentClientId()))},dependencies:[m.MD,m.YU,m.bT,a.YN,a.qT,a.me,a.Q0,a.BC,a.cb,a.VZ,a.zX,a.X1,a.j4,a.JD,h.iI,h.Wk]})}}return n})();var g=c(7673),ee=c(7468),p=c(9437);function te(n,o){1&n&&(e.j41(0,"span"),e.qSk(),e.j41(1,"svg",35),e.nrm(2,"path",36),e.k0s()())}function ie(n,o){1&n&&(e.j41(0,"span"),e.EFF(1,"Este campo es requerido."),e.k0s())}function ne(n,o){1&n&&(e.j41(0,"span"),e.EFF(1,"Solo se permiten letras, n\xfameros, guiones y guiones bajos."),e.k0s())}function re(n,o){if(1&n&&(e.j41(0,"div",53),e.DNE(1,ie,2,0,"span",29),e.DNE(2,ne,2,0,"span",29),e.k0s()),2&n){const t=e.XpG(2);let i,r;e.R7$(1),e.Y8G("ngIf",null==(i=t.newClientForm.get("client_id"))||null==i.errors?null:i.errors.required),e.R7$(1),e.Y8G("ngIf",null==(r=t.newClientForm.get("client_id"))||null==r.errors?null:r.errors.pattern)}}function oe(n,o){1&n&&(e.j41(0,"div",53),e.EFF(1," Este campo es requerido. "),e.k0s())}function se(n,o){if(1&n&&(e.j41(0,"div",54),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(1),e.JRh(t.error)}}function ae(n,o){if(1&n&&(e.j41(0,"div",55),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(1),e.JRh(t.success)}}function le(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",37)(1,"h3",38),e.qSk(),e.j41(2,"svg",39),e.nrm(3,"path",36),e.k0s(),e.EFF(4," Registrar Nuevo Cultivo "),e.k0s(),e.joV(),e.j41(5,"form",40),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.registerClient())}),e.j41(6,"div",41)(7,"div")(8,"label",42),e.EFF(9,"ID del Cultivo *"),e.k0s(),e.nrm(10,"input",43),e.DNE(11,re,3,2,"div",44),e.k0s(),e.j41(12,"div")(13,"label",45),e.EFF(14,"Nombre del Cultivo *"),e.k0s(),e.nrm(15,"input",46),e.DNE(16,oe,2,0,"div",44),e.k0s()(),e.j41(17,"div")(18,"label",47),e.EFF(19,"Descripci\xf3n"),e.k0s(),e.nrm(20,"textarea",48),e.k0s(),e.j41(21,"div",49)(22,"button",50),e.EFF(23," Registrar Cultivo "),e.k0s()()(),e.DNE(24,se,2,1,"div",51),e.DNE(25,ae,2,1,"div",52),e.k0s()}if(2&n){const t=e.XpG();let i,r;e.R7$(5),e.Y8G("formGroup",t.newClientForm),e.R7$(6),e.Y8G("ngIf",t.formSubmitted&&(null==(i=t.newClientForm.get("client_id"))?null:i.invalid)),e.R7$(5),e.Y8G("ngIf",t.formSubmitted&&(null==(r=t.newClientForm.get("name"))?null:r.invalid)),e.R7$(8),e.Y8G("ngIf",t.error),e.R7$(1),e.Y8G("ngIf",t.success)}}function de(n,o){1&n&&(e.j41(0,"div",53),e.EFF(1," Este campo es requerido. "),e.k0s())}function ce(n,o){if(1&n&&(e.j41(0,"div",54),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(1),e.JRh(t.error)}}function ue(n,o){if(1&n&&(e.j41(0,"div",55),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(1),e.JRh(t.success)}}function me(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",37)(1,"h3",38),e.qSk(),e.j41(2,"svg",56),e.nrm(3,"path",57),e.k0s(),e.EFF(4," Editar Cultivo "),e.k0s(),e.joV(),e.j41(5,"form",40),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.updateClient())}),e.j41(6,"div")(7,"label",58),e.EFF(8,"Nombre del Cultivo *"),e.k0s(),e.nrm(9,"input",59),e.DNE(10,de,2,0,"div",44),e.k0s(),e.j41(11,"div")(12,"label",60),e.EFF(13,"Descripci\xf3n"),e.k0s(),e.nrm(14,"textarea",61),e.k0s(),e.j41(15,"div",62)(16,"button",63),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeEditForm())}),e.EFF(17," Cancelar "),e.k0s(),e.j41(18,"button",50),e.EFF(19," Guardar Cambios "),e.k0s()()(),e.DNE(20,ce,2,1,"div",51),e.DNE(21,ue,2,1,"div",52),e.k0s()}if(2&n){const t=e.XpG();let i;e.R7$(5),e.Y8G("formGroup",t.editClientForm),e.R7$(5),e.Y8G("ngIf",t.formSubmitted&&(null==(i=t.editClientForm.get("name"))?null:i.invalid)),e.R7$(10),e.Y8G("ngIf",t.error),e.R7$(1),e.Y8G("ngIf",t.success)}}function ge(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",64)(1,"div",65)(2,"h3",66),e.qSk(),e.j41(3,"svg",67),e.nrm(4,"path",68),e.k0s(),e.EFF(5," \xbfConfirmar eliminaci\xf3n? "),e.k0s(),e.joV(),e.j41(6,"p",69),e.EFF(7," Esta acci\xf3n eliminar\xe1 permanentemente el cultivo y todos sus datos relacionados (sensores, eventos, actuadores, par\xe1metros y estados). Esta acci\xf3n no se puede deshacer. "),e.k0s(),e.j41(8,"div",62)(9,"button",70),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.cancelDelete())}),e.EFF(10," Cancelar "),e.k0s(),e.j41(11,"button",71),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.deleteClient(r.confirmDeleteClientId))}),e.EFF(12," Eliminar Cultivo "),e.k0s()()()()}}function pe(n,o){1&n&&(e.j41(0,"div",72),e.nrm(1,"div",73),e.k0s())}function he(n,o){1&n&&(e.j41(0,"div",74)(1,"div",75),e.qSk(),e.j41(2,"svg",76),e.nrm(3,"path",77),e.k0s(),e.joV(),e.j41(4,"p",78),e.EFF(5,"No hay cultivos registrados."),e.k0s(),e.j41(6,"p",79),e.EFF(7,'Use el bot\xf3n "Agregar Cultivo" para crear uno nuevo.'),e.k0s()()())}function fe(n,o){1&n&&(e.j41(0,"div",130)(1,"span",131),e.qSk(),e.j41(2,"svg",132),e.nrm(3,"path",133),e.k0s()()())}function ve(n,o){1&n&&(e.qSk(),e.j41(0,"svg",134),e.nrm(1,"path",135),e.k0s())}function _e(n,o){1&n&&(e.qSk(),e.j41(0,"svg",134),e.nrm(1,"path",136)(2,"path",137),e.k0s())}const xe=function(n,o){return{"bg-emerald-500":n,"bg-amber-500":o}};function be(n,o){if(1&n&&(e.j41(0,"div",138),e.nrm(1,"div",139),e.k0s()),2&n){const t=e.XpG().$implicit,i=e.XpG(2);e.xc7("left",i.getValuePosition(t.currentTemp,"temp"),"%"),e.R7$(1),e.Y8G("ngClass",e.l_i(3,xe,i.isInRange(t.currentTemp,t.idealTemp,"temp"),!i.isInRange(t.currentTemp,t.idealTemp,"temp")))}}const Ce=function(n,o){return{"bg-blue-500":n,"bg-amber-500":o}};function Fe(n,o){if(1&n&&(e.j41(0,"div",138),e.nrm(1,"div",139),e.k0s()),2&n){const t=e.XpG().$implicit,i=e.XpG(2);e.xc7("left",i.getValuePosition(t.currentHumidity,"humidity"),"%"),e.R7$(1),e.Y8G("ngClass",e.l_i(3,Ce,i.isInRange(t.currentHumidity,t.idealHumidity,"humidity"),!i.isInRange(t.currentHumidity,t.idealHumidity,"humidity")))}}function ke(n,o){if(1&n){const t=e.RV6();e.j41(0,"button",140),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.setAsCurrentClient(r))}),e.qSk(),e.j41(1,"svg",141),e.nrm(2,"path",7),e.k0s(),e.EFF(3," Seleccionar como Cultivo Activo "),e.k0s()}}function Ee(n,o){1&n&&(e.qSk(),e.j41(0,"svg",127),e.nrm(1,"path",145),e.k0s())}function we(n,o){1&n&&(e.qSk(),e.j41(0,"svg",127),e.nrm(1,"path",146),e.k0s())}const $=function(){return["/administration/actuator-control"]},G=function(n,o){return{"bg-amber-500 hover:bg-amber-600":n,"bg-emerald-600 hover:bg-emerald-700":o}};function ye(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",104)(1,"a",142),e.qSk(),e.j41(2,"svg",127),e.nrm(3,"path",22),e.k0s(),e.EFF(4," Controlar "),e.k0s(),e.joV(),e.j41(5,"button",143),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.updateClientStatus(r))}),e.DNE(6,Ee,2,0,"svg",144),e.DNE(7,we,2,0,"svg",144),e.EFF(8),e.k0s()()}if(2&n){const t=e.XpG().$implicit;e.R7$(1),e.Y8G("routerLink",e.lJ4(5,$)),e.R7$(4),e.Y8G("ngClass",e.l_i(6,G,"online"===t.status,"offline"===t.status)),e.R7$(1),e.Y8G("ngIf","online"===t.status),e.R7$(1),e.Y8G("ngIf","offline"===t.status),e.R7$(1),e.SpI(" ","online"===t.status?"Desactivar":"Activar"," ")}}function je(n,o){1&n&&(e.qSk(),e.j41(0,"svg",127),e.nrm(1,"path",145),e.k0s())}function Se(n,o){1&n&&(e.qSk(),e.j41(0,"svg",127),e.nrm(1,"path",146),e.k0s())}function Ie(n,o){if(1&n){const t=e.RV6();e.qSk(),e.joV(),e.j41(0,"button",147),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.updateClientStatus(r))}),e.DNE(1,je,2,0,"svg",144),e.DNE(2,Se,2,0,"svg",144),e.EFF(3),e.k0s()}if(2&n){const t=e.XpG().$implicit;e.Y8G("ngClass",e.l_i(4,G,"online"===t.status,"offline"===t.status)),e.R7$(1),e.Y8G("ngIf","online"===t.status),e.R7$(1),e.Y8G("ngIf","offline"===t.status),e.R7$(1),e.SpI(" ","online"===t.status?"Desactivar":"Activar"," ")}}const Re=function(n,o){return{"border-4 border-emerald-500 ring-2 ring-emerald-300 shadow-lg scale-[1.02] z-10":n,"border border-gray-200 hover:shadow-lg":o}},Te=function(n,o){return{"bg-emerald-50 text-emerald-700 border-emerald-200":n,"bg-gray-50 text-gray-500 border-gray-200":o}},M=function(n,o){return{"bg-emerald-500":n,"bg-gray-400":o}},$e=function(n,o){return{"bg-slate-900":n,"bg-slate-800":o}},Ge=function(n,o){return{"bg-emerald-50":n,"bg-white":o}},Me=function(n,o){return{"bg-blue-50 text-blue-700":n,"bg-amber-50 text-amber-700":o}},b=function(n,o){return{"bg-emerald-500":n,"bg-gray-300":o}},Ae=function(n,o){return{"text-emerald-600":n,"text-amber-600":o}},He=function(n,o){return{"text-blue-600":n,"text-amber-600":o}};function Ve(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",82)(1,"div",83)(2,"span",84)(3,"span",85),e.nrm(4,"span",86)(5,"span",87),e.k0s(),e.EFF(6),e.k0s()(),e.DNE(7,fe,4,0,"div",88),e.j41(8,"div",89)(9,"div",90)(10,"h3",91),e.EFF(11),e.k0s(),e.j41(12,"div",92)(13,"span",93),e.EFF(14),e.k0s()()()(),e.j41(15,"div",94)(16,"div",95)(17,"h4",96),e.EFF(18,"Descripci\xf3n"),e.k0s(),e.j41(19,"p",97),e.EFF(20),e.k0s()(),e.j41(21,"div",98)(22,"div")(23,"h4",96),e.EFF(24,"\xdaltima conexi\xf3n"),e.k0s(),e.j41(25,"p",97),e.EFF(26),e.nI1(27,"date"),e.k0s()(),e.j41(28,"div")(29,"h4",96),e.EFF(30,"Modo"),e.k0s(),e.j41(31,"div",13)(32,"span",99),e.DNE(33,ve,2,0,"svg",100),e.DNE(34,_e,3,0,"svg",100),e.EFF(35),e.k0s()()()(),e.j41(36,"div",101)(37,"h4",102),e.qSk(),e.j41(38,"svg",103),e.nrm(39,"path",22),e.k0s(),e.EFF(40," Actuadores "),e.k0s(),e.joV(),e.j41(41,"div",104)(42,"div",105),e.nrm(43,"div",106),e.j41(44,"span",107),e.EFF(45,"Iluminaci\xf3n"),e.k0s(),e.j41(46,"span",108),e.EFF(47),e.k0s()(),e.j41(48,"div",105),e.nrm(49,"div",106),e.j41(50,"span",107),e.EFF(51,"Ventilaci\xf3n"),e.k0s(),e.j41(52,"span",108),e.EFF(53),e.k0s()(),e.j41(54,"div",105),e.nrm(55,"div",106),e.j41(56,"span",107),e.EFF(57,"Humidificador"),e.k0s(),e.j41(58,"span",108),e.EFF(59),e.k0s()(),e.j41(60,"div",105),e.nrm(61,"div",106),e.j41(62,"span",107),e.EFF(63,"Motor"),e.k0s(),e.j41(64,"span",108),e.EFF(65),e.k0s()()()(),e.j41(66,"div",109)(67,"h4",102),e.qSk(),e.j41(68,"svg",103),e.nrm(69,"path",110),e.k0s(),e.EFF(70," Par\xe1metros ideales "),e.k0s(),e.joV(),e.j41(71,"div",111)(72,"div")(73,"div",112)(74,"span",113),e.EFF(75,"Temperatura"),e.k0s(),e.j41(76,"span",114),e.EFF(77),e.k0s()(),e.j41(78,"div",115)(79,"span",116),e.EFF(80),e.k0s(),e.j41(81,"div",117),e.nrm(82,"div",118)(83,"div",119)(84,"div",120)(85,"div",120),e.DNE(86,be,2,6,"div",121),e.k0s()()(),e.j41(87,"div")(88,"div",112)(89,"span",113),e.EFF(90,"Humedad"),e.k0s(),e.j41(91,"span",114),e.EFF(92),e.k0s()(),e.j41(93,"div",115)(94,"span",116),e.EFF(95),e.k0s(),e.j41(96,"div",117),e.nrm(97,"div",118)(98,"div",122)(99,"div",120)(100,"div",120),e.DNE(101,Fe,2,6,"div",121),e.k0s()()()()(),e.j41(102,"div",123),e.DNE(103,ke,4,0,"button",124),e.DNE(104,ye,9,9,"div",125),e.j41(105,"div",104)(106,"button",126),e.bIt("click",function(){const s=e.eBV(t).$implicit,l=e.XpG(2);return e.Njj(l.openEditForm(s))}),e.qSk(),e.j41(107,"svg",127),e.nrm(108,"path",57),e.k0s(),e.EFF(109," Editar "),e.k0s(),e.joV(),e.j41(110,"button",126),e.bIt("click",function(){const s=e.eBV(t).$implicit,l=e.XpG(2);return e.Njj(l.showDeleteConfirmation(s.client_id))}),e.qSk(),e.j41(111,"svg",127),e.nrm(112,"path",128),e.k0s(),e.EFF(113," Eliminar "),e.k0s()(),e.DNE(114,Ie,4,7,"button",129),e.k0s()()()}if(2&n){const t=o.$implicit,i=e.XpG(2);e.Y8G("ngClass",e.l_i(56,Re,t.client_id===i.getSelectedClientId(),t.client_id!==i.getSelectedClientId())),e.R7$(2),e.Y8G("ngClass",e.l_i(59,Te,"online"===t.status,"offline"===t.status)),e.R7$(2),e.AVh("animate-ping","online"===t.status),e.Y8G("ngClass",e.l_i(62,M,"online"===t.status,"offline"===t.status)),e.R7$(1),e.Y8G("ngClass",e.l_i(65,M,"online"===t.status,"offline"===t.status)),e.R7$(1),e.SpI(" ","online"===t.status?"En l\xednea":"Desconectado"," "),e.R7$(1),e.Y8G("ngIf",t.client_id===i.getSelectedClientId()),e.R7$(1),e.Y8G("ngClass",e.l_i(68,$e,t.client_id===i.getSelectedClientId(),t.client_id!==i.getSelectedClientId())),e.R7$(3),e.JRh(t.name),e.R7$(3),e.JRh(t.client_id),e.R7$(1),e.Y8G("ngClass",e.l_i(71,Ge,t.client_id===i.getSelectedClientId(),t.client_id!==i.getSelectedClientId())),e.R7$(5),e.JRh(t.description||"Sin descripci\xf3n"),e.R7$(6),e.JRh(e.i5U(27,53,t.last_seen,"medium")),e.R7$(6),e.Y8G("ngClass",e.l_i(74,Me,"automatico"===t.controlMode,"manual"===t.controlMode)),e.R7$(1),e.Y8G("ngIf","automatico"===t.controlMode),e.R7$(1),e.Y8G("ngIf","manual"===t.controlMode),e.R7$(1),e.SpI(" ","automatico"===t.controlMode?"Autom\xe1tico":"manual"===t.controlMode?"Manual":"No definido"," "),e.R7$(8),e.Y8G("ngClass",e.l_i(77,b,t.lucesEncendidas,!t.lucesEncendidas)),e.R7$(4),e.JRh(t.lucesEncendidas?"ON":"OFF"),e.R7$(2),e.Y8G("ngClass",e.l_i(80,b,t.ventiladoresEncendidos,!t.ventiladoresEncendidos)),e.R7$(4),e.JRh(t.ventiladoresEncendidos?"ON":"OFF"),e.R7$(2),e.Y8G("ngClass",e.l_i(83,b,t.humidificadorEncendido,!t.humidificadorEncendido)),e.R7$(4),e.JRh(t.humidificadorEncendido?"ON":"OFF"),e.R7$(2),e.Y8G("ngClass",e.l_i(86,b,t.motorEncendido,!t.motorEncendido)),e.R7$(4),e.JRh(t.motorEncendido?"ON":"OFF"),e.R7$(12),e.SpI("",t.idealTemp||"20-28","\xb0C"),e.R7$(2),e.Y8G("ngClass",e.l_i(89,Ae,null!==t.currentTemp&&i.isInRange(t.currentTemp,t.idealTemp,"temp"),null!==t.currentTemp&&!i.isInRange(t.currentTemp,t.idealTemp,"temp"))),e.R7$(1),e.SpI(" ",null!==t.currentTemp?i.formatNumber(t.currentTemp):"--","\xb0C "),e.R7$(3),e.xc7("left",i.getRangeStart(t.idealTemp,"temp"),"%")("width",i.getRangeWidth(t.idealTemp,"temp"),"%"),e.R7$(1),e.xc7("left",i.getRangeStart(t.idealTemp,"temp"),"%"),e.R7$(1),e.xc7("left",i.getRangeEnd(t.idealTemp,"temp"),"%"),e.R7$(1),e.Y8G("ngIf",null!==t.currentTemp),e.R7$(6),e.SpI("",t.idealHumidity||"70-90","%"),e.R7$(2),e.Y8G("ngClass",e.l_i(92,He,null!==t.currentHumidity&&i.isInRange(t.currentHumidity,t.idealHumidity,"humidity"),null!==t.currentHumidity&&!i.isInRange(t.currentHumidity,t.idealHumidity,"humidity"))),e.R7$(1),e.SpI(" ",null!==t.currentHumidity?i.formatNumber(t.currentHumidity):"--","% "),e.R7$(3),e.xc7("left",i.getRangeStart(t.idealHumidity,"humidity"),"%")("width",i.getRangeWidth(t.idealHumidity,"humidity"),"%"),e.R7$(1),e.xc7("left",i.getRangeStart(t.idealHumidity,"humidity"),"%"),e.R7$(1),e.xc7("left",i.getRangeEnd(t.idealHumidity,"humidity"),"%"),e.R7$(1),e.Y8G("ngIf",null!==t.currentHumidity),e.R7$(2),e.Y8G("ngIf",t.client_id!==i.getSelectedClientId()),e.R7$(1),e.Y8G("ngIf",t.client_id===i.getSelectedClientId()),e.R7$(10),e.Y8G("ngIf",t.client_id!==i.getSelectedClientId())}}function De(n,o){if(1&n&&(e.j41(0,"div",80),e.DNE(1,Ve,115,95,"div",81),e.k0s()),2&n){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.clients)}}const Ne=function(){return["/home"]},Ye=[{path:"client-management",component:(()=>{class n{constructor(t,i,r){this.authService=t,this.clientService=i,this.fb=r,this.clients=[],this.isLoading=!0,this.showAddForm=!1,this.formSubmitted=!1,this.error=null,this.success=null,this.showEditForm=!1,this.editingClientId=null,this.confirmDeleteClientId=null,this.dashboardService=(0,e.WQX)(w.I),this.actuatorService=(0,e.WQX)(E.X),this.newClientForm=this.fb.group({client_id:["",[a.k0.required,a.k0.pattern("^[a-zA-Z0-9_-]+$")]],name:["",a.k0.required],description:[""]}),this.editClientForm=this.fb.group({name:["",a.k0.required],description:[""]})}ngOnInit(){this.loadClients()}loadClients(){this.isLoading=!0,this.authService.getClients().subscribe({next:t=>{this.clients=t,this.clients.forEach(i=>{this.enrichClientData(i)}),this.isLoading=!1},error:t=>{console.error("Error loading clients:",t),this.isLoading=!1,this.error="Error al cargar los cultivos. Por favor, intente nuevamente."}})}enrichClientData(t){this.dashboardService.getAppState(t.client_id).pipe((0,p.W)(i=>(console.error(`Error al obtener estado para ${t.client_id}:`,i),(0,g.of)({mode:"no-definido"})))).subscribe(i=>{t.controlMode=i.mode||"no-definido"}),(0,ee.p)({temp:this.actuatorService.getIdealParams(t.client_id,"temperatura").pipe((0,p.W)(i=>(console.error(`Error al obtener par\xe1metros de temperatura para ${t.client_id}:`,i),(0,g.of)({min_value:20,max_value:28})))),humidity:this.actuatorService.getIdealParams(t.client_id,"humedad").pipe((0,p.W)(i=>(console.error(`Error al obtener par\xe1metros de humedad para ${t.client_id}:`,i),(0,g.of)({min_value:70,max_value:90}))))}).subscribe(i=>{t.idealTemp=`${i.temp.min_value}-${i.temp.max_value}`,t.idealHumidity=`${i.humidity.min_value}-${i.humidity.max_value}`,("automatico"===t.controlMode?this.dashboardService.getSht3xUrlData(t.client_id,1,1,!1):this.dashboardService.getSht3xUrlDataManual(t.client_id,1,1,!1)).pipe((0,p.W)(s=>(console.error(`Error al obtener datos de sensores para ${t.client_id}:`,s),(0,g.of)([])))).subscribe(s=>{if(s&&s.length>0){t.currentTemp=s[0].temperature,t.currentHumidity=s[0].humidity;const d=i.humidity.min_value,C=i.humidity.max_value;t.currentTempStatus=t.currentTemp<i.temp.min_value?"warning":t.currentTemp>i.temp.max_value?"critical":"ideal",t.currentHumidityStatus=t.currentHumidity<d?"warning":t.currentHumidity>C?"critical":"ideal"}})}),this.dashboardService.getActuators(t.client_id,1,10,!1).pipe((0,p.W)(i=>(console.error(`Error al obtener estados de actuadores para ${t.client_id}:`,i),(0,g.of)([])))).subscribe(i=>{if(i&&i.length>0){const r=i.find(d=>"Iluminacion"===d.name),s=i.find(d=>"Ventilacion"===d.name),l=i.find(d=>"Humidificador"===d.name),u=i.find(d=>"Motor"===d.name);t.lucesEncendidas="true"===r?.state,t.ventiladoresEncendidos="true"===s?.state,t.humidificadorEncendido="true"===l?.state,t.motorEncendido="true"===u?.state}})}toggleAddForm(){this.showAddForm=!this.showAddForm,this.showAddForm||(this.newClientForm.reset(),this.formSubmitted=!1,this.error=null,this.success=null)}registerClient(){this.formSubmitted=!0,this.error=null,this.success=null,this.newClientForm.valid&&this.authService.registerClient(this.newClientForm.value).subscribe({next:()=>{this.success="Cultivo registrado con \xe9xito.",this.loadClients(),this.newClientForm.reset(),this.formSubmitted=!1,setTimeout(()=>{this.showAddForm=!1,this.success=null},3e3)},error:i=>{console.error("Error al registrar cultivo:",i),this.error="Error al registrar el cultivo. Por favor, intente nuevamente."}})}updateClientStatus(t){const i="online"===t.status?"offline":"online";this.authService.updateClientStatus(t.client_id,{status:i}).subscribe({next:()=>{t.status=i,t.manually_disabled="online"!==i},error:r=>{console.error("Error al actualizar estado:",r),this.error="Error al actualizar el estado del cultivo.",setTimeout(()=>this.error=null,3e3)}})}setAsCurrentClient(t){this.clientService.setCurrentClientId(t.client_id)}onClientSelect(t){this.clientService.setCurrentClientId(t.target.value)}getSelectedClientId(){return this.clientService.getCurrentClientId()}getCurrentClientName(){const t=this.getSelectedClientId(),i=this.clients.find(r=>r.client_id===t);return i?i.name:""}formatNumber(t){return null==t?"--":t.toFixed(4)}isInRange(t,i,r){i||(i="temp"===r?"20-28":"70-90");const[s,l]=i.split("-").map(u=>parseFloat(u));return t>=s&&t<=l}getRangeStart(t,i){t||(t="temp"===i?"20-28":"70-90");const[r]=t.split("-").map(s=>parseFloat(s));return"temp"===i?r/40*100:r}getRangeEnd(t,i){t||(t="temp"===i?"20-28":"70-90");const[r,s]=t.split("-").map(l=>parseFloat(l));return"temp"===i?s/40*100:s}getRangeWidth(t,i){return this.getRangeEnd(t,i)-this.getRangeStart(t,i)}getValuePosition(t,i){return"temp"===i?t/40*100:t}openEditForm(t){this.editingClientId=t.client_id,this.showEditForm=!0,this.editClientForm.patchValue({name:t.name,description:t.description||""}),this.error=null,this.success=null}closeEditForm(){this.showEditForm=!1,this.editingClientId=null,this.editClientForm.reset(),this.error=null,this.success=null}updateClient(){if(this.formSubmitted=!0,this.error=null,this.success=null,this.editClientForm.valid&&this.editingClientId){const t=this.editClientForm.value;this.authService.updateClientInfo(this.editingClientId,t).subscribe({next:()=>{if(this.success="Cultivo actualizado con \xe9xito.",this.loadClients(),this.editingClientId===this.getSelectedClientId()){const i=this.clients.find(r=>r.client_id===this.editingClientId);i&&(i.name=t.name,i.description=t.description)}setTimeout(()=>{this.closeEditForm(),this.success=null},3e3)},error:i=>{console.error("Error al actualizar cultivo:",i),this.error="Error al actualizar el cultivo. Por favor, intente nuevamente."}})}}showDeleteConfirmation(t){this.confirmDeleteClientId=t}cancelDelete(){this.confirmDeleteClientId=null}deleteClient(t){this.error=null,this.success=null,this.authService.deleteClient(t).subscribe({next:()=>{if(this.confirmDeleteClientId=null,t===this.getSelectedClientId()){const i=this.clients.find(r=>r.client_id!==t);i&&this.clientService.setCurrentClientId(i.client_id)}this.loadClients(),this.success="Cultivo eliminado con \xe9xito.",setTimeout(()=>{this.success=null},3e3)},error:i=>{console.error("Error al eliminar cultivo:",i),this.confirmDeleteClientId=null,this.loadClients(),this.error=i?.error?.error&&i.error.error.includes("no such table: sensor_data")?"No se pudo eliminar el cultivo debido a un problema con la base de datos. Contacte al administrador del sistema.":"Error al eliminar el cultivo. Por favor, intente nuevamente.",setTimeout(()=>{this.error=null},3e3)}})}static{this.\u0275fac=function(i){return new(i||n)(e.rXU(j.u),e.rXU(y.X),e.rXU(a.ok))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-client-management"]],standalone:!0,features:[e.aNF],decls:50,vars:14,consts:[[1,"min-h-screen","bg-gradient-to-b","from-gray-50","to-gray-100","p-4","md:p-6"],[1,"max-w-7xl","mx-auto"],[1,"bg-white","rounded-xl","shadow-sm","border","border-emerald-100","mb-8","overflow-hidden"],[1,"border-b","border-gray-100"],[1,"px-6","py-4","flex","items-center"],[1,"bg-emerald-50","rounded-full","p-2","mr-3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","text-emerald-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-xl","font-semibold","text-gray-800"],[1,"p-6"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-6"],[1,"bg-gray-50","rounded-lg","p-4","flex-1"],[1,"text-sm","text-gray-500","mb-2"],[1,"flex","items-center"],[1,"w-3","h-3","rounded-full","bg-emerald-500","mr-2"],[1,"text-xl","font-medium","text-gray-800"],[1,"text-sm","text-gray-500","ml-2"],[1,"flex","flex-col","sm:flex-row","gap-3"],[1,"flex","items-center","justify-center","px-5","py-2.5","bg-indigo-600","hover:bg-indigo-700","text-white","rounded-lg","shadow-sm","transition-all","duration-200","font-medium",3,"routerLink"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","mr-2"],["d","M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"],[1,"flex","items-center","justify-center","px-5","py-2.5","bg-emerald-600","hover:bg-emerald-700","text-white","rounded-lg","shadow-sm","transition-all","duration-200","font-medium",3,"routerLink"],["fill-rule","evenodd","d","M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z","clip-rule","evenodd"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"px-6","py-4","flex","items-center","justify-between"],[1,"bg-indigo-50","rounded-full","p-2","mr-3"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-indigo-500"],["d","M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"],[1,"px-4","py-2","bg-emerald-600","hover:bg-emerald-700","text-white","rounded-lg","shadow-sm","transition-all","duration-200","flex","items-center","gap-2","font-medium",3,"click"],[4,"ngIf"],["class","mb-8 bg-gray-50 p-6 rounded-xl border border-gray-100",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",4,"ngIf"],["class","flex justify-center my-8",4,"ngIf"],["class","bg-blue-50 p-6 rounded-xl shadow-sm text-center",4,"ngIf"],["class","grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule","evenodd"],[1,"mb-8","bg-gray-50","p-6","rounded-xl","border","border-gray-100"],[1,"text-lg","font-semibold","text-gray-800","mb-4","flex","items-center"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-emerald-500","mr-2"],[1,"space-y-4",3,"formGroup","ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","client_id",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","client_id","formControlName","client_id","placeholder","mushroom1, shiitake2, etc.",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500"],["class","text-red-500 text-sm mt-1",4,"ngIf"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","name","formControlName","name","placeholder","Orellana Rosada, Shiitake, etc.",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500"],["for","description",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","description","formControlName","description","rows","3","placeholder","Descripci\xf3n detallada del cultivo...",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500"],[1,"flex","justify-end"],["type","submit",1,"px-6","py-2.5","bg-indigo-600","hover:bg-indigo-700","text-white","rounded-lg","shadow-sm","transition-all","duration-200","font-medium"],["class","mt-4 p-3 bg-red-100 text-red-700 rounded-lg",4,"ngIf"],["class","mt-4 p-3 bg-green-100 text-green-700 rounded-lg",4,"ngIf"],[1,"text-red-500","text-sm","mt-1"],[1,"mt-4","p-3","bg-red-100","text-red-700","rounded-lg"],[1,"mt-4","p-3","bg-green-100","text-green-700","rounded-lg"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-amber-500","mr-2"],["d","M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"],["for","edit_name",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","edit_name","formControlName","name","placeholder","Orellana Rosada, Shiitake, etc.",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500"],["for","edit_description",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","edit_description","formControlName","description","rows","3","placeholder","Descripci\xf3n detallada del cultivo...",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500"],[1,"flex","justify-end","gap-3"],["type","button",1,"px-6","py-2.5","bg-gray-200","hover:bg-gray-300","text-gray-700","rounded-lg","shadow-sm","transition-all","duration-200","font-medium",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-lg","p-6","shadow-xl","max-w-md","mx-auto"],[1,"text-xl","font-bold","text-red-600","mb-4","flex","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"mb-6","text-gray-700"],[1,"px-4","py-2","bg-gray-200","hover:bg-gray-300","text-gray-700","rounded-lg","font-medium",3,"click"],[1,"px-4","py-2","bg-red-600","hover:bg-red-700","text-white","rounded-lg","font-medium",3,"click"],[1,"flex","justify-center","my-8"],[1,"animate-spin","rounded-full","h-12","w-12","border-t-2","border-b-2","border-indigo-500"],[1,"bg-blue-50","p-6","rounded-xl","shadow-sm","text-center"],[1,"text-blue-600","flex","flex-col","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-16","w-16","mb-4","text-blue-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1","d","M12 6v6m0 0v6m0-6h6m-6 0H6"],[1,"text-lg"],[1,"text-sm","mt-2"],[1,"grid","grid-cols-1","lg:grid-cols-2","xl:grid-cols-3","gap-6"],["class","relative bg-white rounded-xl shadow-md overflow-hidden transition duration-300",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative","bg-white","rounded-xl","shadow-md","overflow-hidden","transition","duration-300",3,"ngClass"],[1,"absolute","top-2","right-2","z-20"],[1,"inline-flex","items-center","px-2.5","py-1","rounded-full","text-xs","font-medium","border","shadow-sm",3,"ngClass"],[1,"flex","h-2","w-2","relative","mr-1.5"],[1,"absolute","inline-flex","h-full","w-full","rounded-full","opacity-75",3,"ngClass"],[1,"relative","inline-flex","rounded-full","h-2","w-2",3,"ngClass"],["class","absolute top-2 left-2 z-20",4,"ngIf"],[1,"h-24","relative","overflow-hidden",3,"ngClass"],[1,"absolute","inset-0","flex","flex-col","justify-end","p-4"],[1,"text-xl","font-bold","text-white"],[1,"flex","items-center","mt-1"],[1,"text-white/80","text-sm","font-mono"],[1,"p-4",3,"ngClass"],[1,"mb-4"],[1,"text-xs","uppercase","tracking-wider","text-gray-500","font-semibold","mb-1"],[1,"text-sm","text-gray-700"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"inline-flex","items-center","gap-1","px-2","py-1","rounded-md","text-xs","font-medium",3,"ngClass"],["class","h-3 w-3","fill","currentColor","viewBox","0 0 24 24",4,"ngIf"],[1,"mb-4","p-3","bg-white","rounded-lg","border","border-gray-100","shadow-sm"],[1,"text-xs","uppercase","tracking-wider","text-gray-600","font-semibold","mb-2","flex","items-center"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-3.5","w-3.5","mr-1","text-gray-600"],[1,"grid","grid-cols-2","gap-2"],[1,"flex","items-center","gap-1.5"],[1,"w-2","h-2","rounded-full",3,"ngClass"],[1,"text-xs","text-gray-700"],[1,"text-xs","text-gray-500","ml-auto"],[1,"mb-5","p-3","bg-white","rounded-lg","border","border-gray-100","shadow-sm"],["d","M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"],[1,"space-y-3"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-xs","text-gray-500"],[1,"text-xs","font-medium","text-gray-700"],[1,"flex","items-center","mb-1"],[1,"text-sm","font-medium","mr-2","w-16","text-right",3,"ngClass"],[1,"flex-grow","relative","h-6"],[1,"absolute","inset-0","bg-gray-200","rounded-md"],[1,"absolute","inset-y-0","bg-emerald-100","rounded-md"],[1,"absolute","inset-y-0","w-0.5","bg-gray-300"],["class","absolute inset-y-0 flex items-center justify-center",3,"left",4,"ngIf"],[1,"absolute","inset-y-0","bg-blue-100","rounded-md"],[1,"space-y-2"],["class","w-full flex items-center justify-center px-4 py-2.5 bg-slate-700 hover:bg-slate-800 text-white rounded-lg shadow-sm transition-colors gap-2",3,"click",4,"ngIf"],["class","grid grid-cols-2 gap-2",4,"ngIf"],[1,"flex","items-center","justify-center","px-3","py-2","bg-gray-100","hover:bg-gray-200","text-gray-700","rounded-lg","transition-colors",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-4","w-4","mr-1.5"],["fill-rule","evenodd","d","M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule","evenodd"],["class","w-full flex items-center justify-center px-4 py-2.5 text-white rounded-lg shadow-sm transition-colors",3,"ngClass","click",4,"ngIf"],[1,"absolute","top-2","left-2","z-20"],[1,"inline-flex","items-center","p-1.5","rounded-full","text-xs","font-medium","bg-emerald-50","text-emerald-700","border","border-emerald-200"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"w-3.5","h-3.5"],["d","M20 6L9 17L4 12","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["fill","currentColor","viewBox","0 0 24 24",1,"h-3","w-3"],["d","M21 15a9.11 9.11 0 01-5 8.1l-.9-1.8A7.07 7.07 0 0019 15h2zm-9-9a9.11 9.11 0 015 8.1l-2 .2A7.07 7.07 0 0112 8V6zM3 15a9.11 9.11 0 015-8.1l.9 1.8A7.07 7.07 0 005 15H3zm9 9a9.11 9.11 0 01-5-8.1l2-.2A7.07 7.07 0 0112 22v2zM12 1a11 11 0 00-11 11 11 11 0 1022 0 11 11 0 00-11-11zm0 20a9 9 0 110-18 9 9 0 010 18z"],["d","M11 16.7a1 1 0 002 0V11a1 1 0 10-2 0v5.7zm1-10.9a1.3 1.3 0 100 2.6 1.3 1.3 0 000-2.6z"],["d","M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"],[1,"absolute","inset-y-0","flex","items-center","justify-center"],[1,"w-3","h-3","rounded-full","border-2","border-white","shadow",3,"ngClass"],[1,"w-full","flex","items-center","justify-center","px-4","py-2.5","bg-slate-700","hover:bg-slate-800","text-white","rounded-lg","shadow-sm","transition-colors","gap-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],[1,"flex","items-center","justify-center","px-4","py-2.5","bg-blue-600","hover:bg-blue-700","text-white","rounded-lg","shadow-sm","transition-colors",3,"routerLink"],[1,"flex","items-center","justify-center","px-4","py-2.5","text-white","rounded-lg","shadow-sm","transition-colors",3,"ngClass","click"],["xmlns","http://www.w3.org/2000/svg","class","h-4 w-4 mr-1.5","viewBox","0 0 20 20","fill","currentColor",4,"ngIf"],["fill-rule","evenodd","d","M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"w-full","flex","items-center","justify-center","px-4","py-2.5","text-white","rounded-lg","shadow-sm","transition-colors",3,"ngClass","click"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e.qSk(),e.j41(6,"svg",6),e.nrm(7,"path",7),e.k0s()(),e.joV(),e.j41(8,"h2",8),e.EFF(9,"Selecci\xf3n de Cultivo Activo"),e.k0s()()(),e.j41(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12),e.EFF(14,"Cultivo actualmente seleccionado:"),e.k0s(),e.j41(15,"div",13),e.nrm(16,"div",14),e.j41(17,"div")(18,"span",15),e.EFF(19),e.k0s(),e.j41(20,"span",16),e.EFF(21),e.k0s()()()(),e.j41(22,"div",17)(23,"a",18),e.qSk(),e.j41(24,"svg",19),e.nrm(25,"path",20),e.k0s(),e.EFF(26," Dashboard "),e.k0s(),e.joV(),e.j41(27,"a",21),e.qSk(),e.j41(28,"svg",19),e.nrm(29,"path",22),e.k0s(),e.EFF(30," Controlar Actuadores "),e.k0s()()()()(),e.joV(),e.j41(31,"div",23)(32,"div",3)(33,"div",24)(34,"div",13)(35,"div",25),e.qSk(),e.j41(36,"svg",26),e.nrm(37,"path",27),e.k0s()(),e.joV(),e.j41(38,"h2",8),e.EFF(39,"Mis Cultivos"),e.k0s()(),e.j41(40,"button",28),e.bIt("click",function(){return r.toggleAddForm()}),e.DNE(41,te,3,0,"span",29),e.EFF(42),e.k0s()()(),e.j41(43,"div",9),e.DNE(44,le,26,5,"div",30),e.DNE(45,me,22,4,"div",30),e.DNE(46,ge,13,0,"div",31),e.DNE(47,pe,2,0,"div",32),e.DNE(48,he,8,0,"div",33),e.DNE(49,De,2,1,"div",34),e.k0s()()()()),2&i&&(e.R7$(19),e.JRh(r.getCurrentClientName()||"No hay cultivo seleccionado"),e.R7$(2),e.SpI("(ID: ",r.getSelectedClientId(),")"),e.R7$(2),e.Y8G("routerLink",e.lJ4(12,Ne)),e.R7$(4),e.Y8G("routerLink",e.lJ4(13,$)),e.R7$(14),e.Y8G("ngIf",!r.showAddForm),e.R7$(1),e.SpI(" ",r.showAddForm?"Cancelar":"Agregar Cultivo"," "),e.R7$(2),e.Y8G("ngIf",r.showAddForm),e.R7$(1),e.Y8G("ngIf",r.showEditForm),e.R7$(1),e.Y8G("ngIf",r.confirmDeleteClientId),e.R7$(1),e.Y8G("ngIf",r.isLoading),e.R7$(1),e.Y8G("ngIf",!r.isLoading&&0===r.clients.length),e.R7$(1),e.Y8G("ngIf",!r.isLoading&&r.clients.length>0))},dependencies:[m.MD,m.YU,m.Sq,m.bT,m.vh,a.YN,a.qT,a.me,a.BC,a.cb,a.X1,a.j4,a.JD,h.iI,h.Wk],encapsulation:2})}}return n})()},{path:"actuator-control",component:K},{path:"",redirectTo:"client-management",pathMatch:"full"}]}}]);